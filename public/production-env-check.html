<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Production Environment Checker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .check-item {
            background: white;
            margin: 10px 0;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .status {
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        .status.pass {
            background-color: #d4edda;
            color: #155724;
        }
        .status.fail {
            background-color: #f8d7da;
            color: #721c24;
        }
        .status.unknown {
            background-color: #fff3cd;
            color: #856404;
        }
        .details {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .summary {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>üîç Production Environment Checker</h1>
    <p>This tool checks for common production deployment issues.</p>
    
    <div id="checks"></div>
    
    <div class="summary" id="summary"></div>
    
    <script>
        const checks = [
            {
                name: 'Environment Detection',
                test: () => {
                    const isProduction = window.location.hostname !== 'localhost' && !window.location.hostname.includes('127.0.0.1');
                    return {
                        pass: isProduction,
                        details: `Hostname: ${window.location.hostname}`
                    };
                }
            },
            {
                name: 'HTTPS Protocol',
                test: () => {
                    const isHTTPS = window.location.protocol === 'https:';
                    return {
                        pass: isHTTPS,
                        details: `Protocol: ${window.location.protocol}`
                    };
                }
            },
            {
                name: 'Environment Variables Access',
                test: () => {
                    try {
                        // Check if Vite env vars are accessible
                        const hasViteEnv = typeof import.meta !== 'undefined' && import.meta.env;
                        const supabaseUrl = hasViteEnv ? import.meta.env.VITE_SUPABASE_URL : 'NOT_ACCESSIBLE';
                        const supabaseKey = hasViteEnv ? import.meta.env.VITE_SUPABASE_ANON_KEY : 'NOT_ACCESSIBLE';
                        
                        const hasUrl = supabaseUrl && supabaseUrl !== 'NOT_ACCESSIBLE' && supabaseUrl.includes('supabase');
                        const hasKey = supabaseKey && supabaseKey !== 'NOT_ACCESSIBLE' && supabaseKey.length > 50;
                        
                        return {
                            pass: hasUrl && hasKey,
                            details: `URL: ${hasUrl ? '‚úì' : '‚úó'}, Key: ${hasKey ? '‚úì' : '‚úó'}`
                        };
                    } catch (error) {
                        return {
                            pass: false,
                            details: `Error: ${error.message}`
                        };
                    }
                }
            },
            {
                name: 'Console Errors',
                test: () => {
                    // Check for console errors (this is a simplified check)
                    const hasErrors = window.console && window.console.error;
                    return {
                        pass: true, // We can't easily detect past console errors
                        details: 'Check browser console manually for errors'
                    };
                }
            },
            {
                name: 'Local Storage Access',
                test: () => {
                    try {
                        localStorage.setItem('test', 'test');
                        const canRead = localStorage.getItem('test') === 'test';
                        localStorage.removeItem('test');
                        return {
                            pass: canRead,
                            details: 'Local storage read/write test'
                        };
                    } catch (error) {
                        return {
                            pass: false,
                            details: `Error: ${error.message}`
                        };
                    }
                }
            },
            {
                name: 'Session Storage Access',
                test: () => {
                    try {
                        sessionStorage.setItem('test', 'test');
                        const canRead = sessionStorage.getItem('test') === 'test';
                        sessionStorage.removeItem('test');
                        return {
                            pass: canRead,
                            details: 'Session storage read/write test'
                        };
                    } catch (error) {
                        return {
                            pass: false,
                            details: `Error: ${error.message}`
                        };
                    }
                }
            },
            {
                name: 'Network Connectivity',
                test: () => {
                    const isOnline = navigator.onLine;
                    return {
                        pass: isOnline,
                        details: `Navigator.onLine: ${isOnline}`
                    };
                }
            },
            {
                name: 'JavaScript Modules Support',
                test: () => {
                    const hasModules = 'noModule' in HTMLScriptElement.prototype;
                    return {
                        pass: hasModules,
                        details: 'ES6 modules support check'
                    };
                }
            },
            {
                name: 'Fetch API Support',
                test: () => {
                    const hasFetch = typeof fetch !== 'undefined';
                    return {
                        pass: hasFetch,
                        details: 'Fetch API availability'
                    };
                }
            },
            {
                name: 'WebCrypto API Support',
                test: () => {
                    const hasCrypto = typeof crypto !== 'undefined' && typeof crypto.randomUUID === 'function';
                    return {
                        pass: hasCrypto,
                        details: 'Required for file upload security'
                    };
                }
            }
        ];
        
        function runChecks() {
            const checksContainer = document.getElementById('checks');
            const summaryContainer = document.getElementById('summary');
            
            let passCount = 0;
            let failCount = 0;
            
            checks.forEach(check => {
                const result = check.test();
                
                const checkElement = document.createElement('div');
                checkElement.className = 'check-item';
                
                const statusClass = result.pass ? 'pass' : 'fail';
                const statusText = result.pass ? 'PASS' : 'FAIL';
                const statusIcon = result.pass ? '‚úÖ' : '‚ùå';
                
                if (result.pass) passCount++;
                else failCount++;
                
                checkElement.innerHTML = `
                    <div>
                        <strong>${check.name}</strong>
                        <div class="details">${result.details}</div>
                    </div>
                    <div class="status ${statusClass}">${statusIcon} ${statusText}</div>
                `;
                
                checksContainer.appendChild(checkElement);
            });
            
            // Update summary
            const totalChecks = checks.length;
            const successRate = Math.round((passCount / totalChecks) * 100);
            
            let summaryClass = 'unknown';
            let summaryMessage = '';
            
            if (successRate >= 90) {
                summaryClass = 'pass';
                summaryMessage = '‚úÖ Environment looks good! Issues might be server-side or configuration-related.';
            } else if (successRate >= 70) {
                summaryClass = 'unknown';
                summaryMessage = '‚ö†Ô∏è Some issues detected. Check failed items above.';
            } else {
                summaryClass = 'fail';
                summaryMessage = '‚ùå Multiple issues detected. Environment needs attention.';
            }
            
            summaryContainer.innerHTML = `
                <h3>Summary: ${passCount}/${totalChecks} checks passed (${successRate}%)</h3>
                <div class="status ${summaryClass}">${summaryMessage}</div>
            `;
        }
        
        // Run checks when page loads
        window.addEventListener('load', runChecks);
    </script>
</body>
</html>